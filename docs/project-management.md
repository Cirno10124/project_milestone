# 项目管理使用说明（组织 / 项目 / WBS / 任务 / 关键路径 / 甘特图）

本文档面向日常使用者（项目管理员/成员），介绍系统内“项目管理”相关的核心操作流程。

---

## 入口与基本概念

- **组织（Org）**：系统按组织隔离数据。登录后必须先选择组织，后续请求会携带 `X-Org-Id`。
- **项目（Project）**：在组织下创建；项目内包含 WBS、任务、依赖关系、关键路径分析结果等。
- **WBS 节点**：用于按里程碑/阶段组织任务，并支持排序（`seq`）。
- **任务（Task）**：挂在某个 WBS 节点下，支持工期（天）、进度（%）、处理人、依赖关系（前置/后继）。
- **关键路径分析（CPM）**：计算 ES/EF/LS/LF/Slack，标记关键任务（Slack=0）。
- **部门（Group）**：组织内的“部门/小组”，用于组织用户（与项目成员是两套维度）。

---

## 1) 选择/切换组织

### 进入组织选择页

- 登录后若未选择组织，会自动跳转到 **选择组织** 页面：`/org/select`

### 创建组织并进入

- 在“新组织名称”输入框填写名称
- 点击 **创建并进入**

### 进入已有组织

- 在“我加入的组织”列表找到组织
- 点击 **进入**

### 从项目页切换组织

- 在 **项目列表页**（`/projects`）右上角点击 **切换组织**，返回组织选择页

---

## 2) 项目列表与创建

### 查看我的项目

- 路径：`/projects`
- 显示当前组织下，你有权限访问的项目列表

### 新建项目

- 在项目列表页点击 **新建项目**
- 填写项目名称、描述后提交
- 创建成功会自动进入项目详情页：`/projects/:id`

---

## 3) 项目详情（核心工作台）

路径：`/projects/:id`

> 提示：页面会根据你的项目角色显示不同操作。通常 **admin** 可编辑，**member** 以查看为主。

### 3.1 WBS 管理（里程碑/阶段）

- 点击 **添加 WBS 节点**，填写：
  - 名称
  - 持续天数（用于计划/展示，可被后续“计算日期”更新）
  - 描述（可选）
- 在 WBS 列表可调整 `seq`（排序号），用于控制展示顺序

### 3.2 任务管理（创建/进度/处理人）

- **新建任务**：
  - 选择所属 WBS 节点
  - 填写任务名称、预计时长（天）
- **更新进度**：
  - 在任务表格里修改“完成情况(%)”
  - 点击 **更新**
- **转派处理人**（项目管理员）：
  - 点击某任务的 **转派**
  - 从项目成员中多选处理人并保存

### 3.3 依赖关系（前置/后继）

- 在“添加任务后继”区域：
  - 选择 **基准任务**
  - 选择一个或多个 **后继任务**
  - 点击 **创建后继依赖**

> 系统会避免选择“会造成环”的后继候选（只显示允许的后继任务）。

### 3.4 关键路径分析（CPM）

- 点击 **运行关键路径分析**
- 任务表格会展示：
  - ES/EF/LS/LF（最早/最晚开始结束）
  - Slack（时差）
  - Slack=0 的任务会被标记为 **关键**（并有高亮样式）

> 若项目未设置开始日期：系统会在首次计算时自动用“首次提交当天”写入项目开始日期；但仍建议项目管理员明确设置开始日期（见下一节）。

### 3.5 项目开始日期与“计算日期”

（项目管理员可见）

- 在“项目开始日期”选择日期
- 点击 **计算日期**
  - 会保存项目开始日期
  - 在前端按依赖与工期计算项目预计完成时间
  - 并将每个任务的 `startDate/endDate` 写回后端（用于甘特图预览/导出）
  - 同时会根据任务时间范围更新 WBS 节点的持续时间

### 3.6 甘特图预览与导出

（项目管理员可见）

- **预览甘特图**：在弹窗里生成甘特图
- **导出甘特图（PNG / SVG）**：基于预览内容导出
- **导出甘特表（Excel）**：导出 Excel（如需可直接用于汇报）

> 若提示“没有任何带有效日期的任务”：请先设置项目开始日期并点击“计算日期”，或补齐任务日期。

### 3.7 Git 联动（可选）

（项目管理员可见）

- 在项目详情页的 **Git 联动**区域配置仓库地址、服务类型、默认分支，并启用“commit 自动更新任务进度”
- Webhook 与 commit message 规则请阅读：`docs/git-integration.md`

---

## 4) 项目成员管理

路径：`/projects/:id/members`

- **仅项目管理员**可管理成员
- 功能：
  - 从“组织用户”下拉框选择用户，设置角色（admin/member）后点击 **添加/更新**
  - 在成员列表中可修改角色，或移除成员

---

## 5) 部门（Group）管理（组织维度）

路径：`/groups`

- 可创建部门、为部门添加/移除成员
- 若你没有组织管理员权限，相关操作会提示“需要组织管理员权限”

---

## 常见问题（FAQ）

### 1) 登录后总是跳到“选择组织”

- 这是正常行为：系统要求先选定组织（请求需要 `X-Org-Id`）
- 在组织选择页进入任意组织后再访问项目列表即可

### 2) 关键路径分析失败 / 没有日期

- 确认任务是否填写了 **工期（天）**
- 确认是否设置了依赖关系（可选，但无依赖时所有任务会从基准日期开始排）
- 若你希望甘特图/日期更准确，建议先设置项目开始日期并点击“计算日期”

